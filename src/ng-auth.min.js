"use strict";function authService(t,n,i,e,r,a,u){function o(t,n,i,e){this.roles=t,this.url=n,this.user=i,this.$http=e,this.authorized=!1,this.pendingAuth=!1}o.prototype.authenticate=function(){var t=this.$http.get(this.url.authenticate);return a.$broadcast("authenticating",t),this.pendingAuth=t,t},o.prototype.login=function(){var t=this.$http.post(this.url.login,this.user);return a.$broadcast("authenticating",t),t},o.prototype.logout=function(){var t=this.$http.post(this.url.logout);return a.$broadcast("authenticating",t),t},o.prototype.canAccess=function(t){t=t.split(",");var n=!1;for(var i in t){if(t[i]===this.user.type){n=!0;break}n=!1}return n};var s=new o(t,n,i,r),h=function(t){var n=!1;for(var i in e)if(n=e[i]===t)break;return n};return a.$on("$routeChangeStart",function(t,i,e){s.pendingAuth||"undefined"==typeof i||(!s.authorized&&i.hasOwnProperty("$$route")?h(i.$$route.originalPath)||u.path(n.login):s.authorized&&i.hasOwnProperty("$$route")&&i.$$route.originalPath===n.login&&u.path(n.home))}),a.$on("authenticating",function(t,i,e){i.then(function(t){if(s.pendingAuth=!1,i.$$state.value.config.url===n.logout)s.authorized=!1,u.path(n.login);else{s.user=t.data;var e=u.$$url===n.login?n.home:u.$$url;u.path(e),s.authorized=!0}},function(t){s.pendingAuth=!1,i.$$state.value.config.url===n.logout?s.authorized=!0:(s.authorized=!1,h(u.$$url)?u.path(u.$$url):u.path(n.login))})}),s}!function(t,n){t.module("ngAuth",[]).provider("authService",function(){this.roles=[],this.user={username:"",password:"",rememberMe:!1},this.url={login:"",logout:"",authenticate:"",home:""},this.globalUrl=[],this.$get=function(t,i,e){var r=new n(this.roles,this.url,this.user,this.globalUrl,t,i,e);return r.authenticate(r),r}}).directive("only",function(t,n){return{restrict:"A",link:function(n,i,e){n.$watch("authService.authorized",function(n,r){n?t.canAccess(e.only)||"all"===e.only?i.css("display",""):i.css("display","none"):r&&!r||n||i.css("display","none")},!0)}}}).directive("public",function(t){return{restrict:"A",link:function(t,n,i){t.$watch("authService.authorized",function(t,i){t?n.css("display","none"):n.css("display","")})}}}).directive("avatarWidget",function(t){return{template:'<span class="avatar" style="background-image: url({{avatar}})"></span>',link:function(t,n,i){t.$watch("authService.user.avatar.url",function(n,i){t.avatar="undefined"!=typeof n?n:"http://res.cloudinary.com/ddmfgtsxy/image/upload/v1452700962/default.png"})}}})}(angular,authService);
